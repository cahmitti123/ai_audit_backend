# Docker Environment Configuration
# Copy this to .env before running docker-compose

# Server
NODE_ENV=production
PORT=3002
SERVER_PORT=3002
INNGEST_PORT=8288
# How many API server containers you run (should match: `docker compose ... --scale server=N`)
SERVER_REPLICAS=6
# Default parallelism per server instance (global concurrency = this * SERVER_REPLICAS)
INNGEST_PARALLELISM_PER_SERVER=10

# Database (Update with your production database)
DATABASE_URL="postgresql://user:password@host:5432/ai_audit"
DIRECT_URL="postgresql://user:password@host:5432/ai_audit"

# Fiche API
FICHE_API_BASE_URL="https://your-api-url.com"
FICHE_API_AUTH_TOKEN="your-token"

# AI Services
OPENAI_API_KEY="sk-your-openai-key"
ANTHROPIC_API_KEY="your-anthropic-key"

# OpenAI models (override as needed)
# Docs: `https://platform.openai.com/docs/models/gpt-5.2`
OPENAI_MODEL_AUDIT="gpt-5.2"
OPENAI_MODEL_CHAT="gpt-5.2"
# Optional chat tuning (lower = less hallucination)
OPENAI_TEMPERATURE_CHAT="0"
# OPENAI_MAX_TOKENS_CHAT="3000"

# Audit accuracy / anti-hallucination
AUDIT_EVIDENCE_GATING="1"
# For product verification: vector-store fallback is opt-in (DB matching is preferred for accuracy)
PRODUCT_VECTORSTORE_FALLBACK="0"
# For product verification steps: use a smaller timeline excerpt to keep prompts focused & avoid context overflow
AUDIT_STEP_TIMELINE_EXCERPT="1"
AUDIT_STEP_TIMELINE_MAX_CHUNKS="40"

# ElevenLabs (Transcription)
ELEVENLABS_API_KEY="your-elevenlabs-key"

# Inngest
INNGEST_EVENT_KEY="your-inngest-event-key"
INNGEST_SIGNING_KEY="your-inngest-signing-key"
INNGEST_APP_ID="ai-audit-system"

# Webhook URL allowlist (Optional)
# ===============================
# SSRF protection for user-provided webhookUrl (progressive fetch):
# Comma-separated list of allowed URL origins (protocol + host + optional port).
WEBHOOK_ALLOWED_ORIGINS="http://your-frontend:3000"

# Redis (shared coordination)
REDIS_URL="redis://redis:6379"

# Pusher Channels (backend server SDK)
PUSHER_APP_ID="your-pusher-app-id"
PUSHER_KEY="your-pusher-key"
PUSHER_SECRET="your-pusher-secret"
PUSHER_CLUSTER="eu"
# Optional:
# PUSHER_USE_PRIVATE_CHANNELS="1"
# PUSHER_MAX_PAYLOAD_BYTES="9000"
# PUSHER_DRY_RUN="0"

# Optional: tune internal parallelism (safe defaults)
# NOTE: Most Inngest worker concurrency defaults scale automatically via:
#   INNGEST_PARALLELISM_PER_SERVER * SERVER_REPLICAS
# AUDIT_STEP_CONCURRENCY="3"
# TRANSCRIPTION_RECORDING_CONCURRENCY="2"
# FICHE_SALES_CACHE_CONCURRENCY="10"
# AUDIT_RUN_PER_FICHE_CONCURRENCY="1"
# TRANSCRIPTION_FINALIZER_CONCURRENCY="50"
# TRANSCRIPTION_PROGRESS_WEBHOOK_FREQUENCY="3"
# TRANSCRIPTION_RUN_STATE_TTL_SECONDS="7200"
# TRANSCRIPTION_LOCK_TTL_MS="1800000"
# AUDIT_BATCH_STATE_TTL_SECONDS="21600"
# BATCH_AUDIT_PROGRESS_CONCURRENCY="50"
# AUTOMATION_FICHE_FETCH_CONCURRENCY="5"
# AUTOMATION_SCHEDULER_WINDOW_MINUTES="20"
# AUTOMATION_SCHEDULER_CRON="*/15 * * * *"

# Vector Store (Product Verification)
VECTOR_STORE_ID="vs_..."
VECTOR_STORE_MAX_RESULTS="5"

