# Database
DATABASE_URL="postgresql://user:password@localhost:5432/ai_audit"
DIRECT_URL="postgresql://user:password@localhost:5432/ai_audit"

# Fiche API
FICHE_API_BASE_URL="https://your-api-url.com"
# Optional: only if your CRM/API requires auth (not used by all deployments)
# FICHE_API_AUTH_TOKEN="your-token"

# AI Services
OPENAI_API_KEY="your-openai-key"
ANTHROPIC_API_KEY="your-anthropic-key"

# OpenAI models (defaults are safe; override per environment as needed)
# Docs: `https://platform.openai.com/docs/models/gpt-5.2`
OPENAI_MODEL_AUDIT="gpt-5.2"
OPENAI_MODEL_CHAT="gpt-5.2"
# Optional chat tuning (lower = less hallucination)
OPENAI_TEMPERATURE_CHAT="0"
# OPENAI_MAX_TOKENS_CHAT="3000"

# Audit accuracy / anti-hallucination
# If enabled, the backend will drop hallucinated citations (quotes not present in transcript chunks)
# and conservatively downgrade unsupported "PRESENT" claims.
AUDIT_EVIDENCE_GATING="1"
# For product verification: vector-store fallback is opt-in (DB matching is preferred for accuracy)
PRODUCT_VECTORSTORE_FALLBACK="0"
# For product verification steps: use a smaller timeline excerpt to keep prompts focused & avoid context overflow
AUDIT_STEP_TIMELINE_EXCERPT="1"
AUDIT_STEP_TIMELINE_MAX_CHUNKS="40"

# Vector Store (Product Verification)
VECTOR_STORE_ID="vs_..."
VECTOR_STORE_MAX_RESULTS="5"

# ElevenLabs (Transcription)
ELEVENLABS_API_KEY="your-elevenlabs-key"

# Inngest Configuration
# =====================
# Three modes available:
# 1. Development Mode (INNGEST_DEV=1): No external server needed, runs locally
# 2. Self-Hosted (INNGEST_DEV=0 + INNGEST_BASE_URL): Connects to Docker container
# 3. Cloud (INNGEST_DEV=0, no BASE_URL): Connects to Inngest Cloud (requires event key)

# Development mode (recommended for local dev)
INNGEST_DEV="1"

# For production/Docker (set INNGEST_DEV=0 and configure these):
# INNGEST_EVENT_KEY="your-inngest-event-key"
# INNGEST_SIGNING_KEY="0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"
# INNGEST_BASE_URL="http://inngest:8288"

# Generate signing key with: openssl rand -hex 32

# Webhook URL allowlist (Optional)
# ===============================
# SSRF protection for user-provided webhookUrl (progressive fetch):
# Comma-separated list of allowed URL origins (protocol + host + optional port).
# Example: WEBHOOK_ALLOWED_ORIGINS="http://localhost:3000,https://your-frontend.vercel.app"
WEBHOOK_ALLOWED_ORIGINS="http://localhost:3000"

# Pusher Channels (backend server SDK)
# ====================================
# Only PUSHER_KEY + PUSHER_CLUSTER go to the browser.
# Never expose PUSHER_SECRET or PUSHER_APP_ID to the client.
PUSHER_APP_ID=""
PUSHER_KEY=""
PUSHER_SECRET=""
PUSHER_CLUSTER=""
# Optional: allow backend to read the same key the Next.js app uses
# NEXT_PUBLIC_PUSHER_KEY=""
#
# Optional toggles:
# PUSHER_USE_PRIVATE_CHANNELS="1"
# PUSHER_MAX_PAYLOAD_BYTES="9000"
# PUSHER_DRY_RUN="0"

# Redis (shared coordination)
# Use Redis in production & multi-replica deployments.
# Local dev: `redis://localhost:6379`
REDIS_URL="redis://localhost:6379"

# Inngest concurrency scaling (recommended)
# ========================================
# Default global concurrency for most workers is computed as:
#   INNGEST_PARALLELISM_PER_SERVER * INNGEST_SERVER_REPLICAS
#
# - INNGEST_PARALLELISM_PER_SERVER: parallel work per server instance (default 10)
# - INNGEST_SERVER_REPLICAS: how many API server replicas you run (docker: `--scale server=N`)
#
# INNGEST_PARALLELISM_PER_SERVER="10"
# INNGEST_SERVER_REPLICAS="1"
#
# Optional: override specific workflow concurrency (advanced)
# ==========================================================
# - Global caps (across ALL replicas):
# AUDIT_RUN_CONCURRENCY="60"
# TRANSCRIPTION_FICHE_CONCURRENCY="60"
# FICHE_FETCH_CONCURRENCY="60"
# AUDIT_STEP_WORKER_CONCURRENCY="60"
# TRANSCRIPTION_RECORDING_WORKER_CONCURRENCY="60"
# TRANSCRIPTION_FINALIZER_CONCURRENCY="60"
# BATCH_AUDIT_PROGRESS_CONCURRENCY="60"
# PROGRESSIVE_FETCH_DAY_CONCURRENCY="60"
#
# - Per-entity caps:
# AUDIT_RUN_PER_FICHE_CONCURRENCY="1"
# AUDIT_STEP_PER_AUDIT_CONCURRENCY="10"
# TRANSCRIPTION_RECORDING_PER_FICHE_CONCURRENCY="10"
#
# - In-process parallelism (per server instance):
# AUDIT_STEP_CONCURRENCY="10"
# TRANSCRIPTION_RECORDING_CONCURRENCY="10"
# FICHE_SALES_CACHE_CONCURRENCY="10"
# TRANSCRIPTION_PROGRESS_WEBHOOK_FREQUENCY="3"
# TRANSCRIPTION_RUN_STATE_TTL_SECONDS="7200"
# TRANSCRIPTION_LOCK_TTL_MS="1800000"
# AUDIT_BATCH_STATE_TTL_SECONDS="21600"
# AUTOMATION_FICHE_FETCH_CONCURRENCY="5"
# AUTOMATION_SCHEDULER_WINDOW_MINUTES="20"
# AUTOMATION_SCHEDULER_CRON="*/1 * * * *"

# Server
PORT=3002
NODE_ENV="development"
