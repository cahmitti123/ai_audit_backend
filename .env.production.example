# ============================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ============================================
# Copy this file to .env.production and fill in your production values
# NEVER commit real secrets to version control!

# ============================================
# DATABASE CONFIGURATION
# ============================================
# Production PostgreSQL connection (Supabase, AWS RDS, DigitalOcean, etc.)
DATABASE_URL="postgresql://user:password@your-db-host.com:5432/ai_audit_prod"
DIRECT_URL="postgresql://user:password@your-db-host.com:5432/ai_audit_prod"

# ============================================
# FICHE API (Your CRM/Data Source)
# ============================================
FICHE_API_BASE_URL="https://your-production-api.com"
FICHE_API_AUTH_TOKEN="your-production-api-token"

# ============================================
# AI SERVICE KEYS
# ============================================
OPENAI_API_KEY="sk-proj-..."
ANTHROPIC_API_KEY="sk-ant-..."
ELEVENLABS_API_KEY="..."

# ============================================
# AI MODEL CONFIGURATION
# ============================================
OPENAI_MODEL_AUDIT="gpt-5.2"
OPENAI_MODEL_CHAT="gpt-5.2"
OPENAI_TEMPERATURE_CHAT="0"

# ============================================
# VECTOR STORE (Product Verification)
# ============================================
VECTOR_STORE_ID="vs_..."
VECTOR_STORE_MAX_RESULTS="5"

# ============================================
# AUDIT CONFIGURATION
# ============================================
# Evidence gating: prevent hallucinated citations (recommended: 1)
AUDIT_EVIDENCE_GATING="1"
# Product vectorstore fallback (recommended: 0 for accuracy)
PRODUCT_VECTORSTORE_FALLBACK="0"
# Timeline excerpt optimization
AUDIT_STEP_TIMELINE_EXCERPT="1"
AUDIT_STEP_TIMELINE_MAX_CHUNKS="40"

# ============================================
# INNGEST ORCHESTRATION (PRODUCTION)
# ============================================
NODE_ENV="production"
INNGEST_DEV="0"

# Generate these with:
# INNGEST_EVENT_KEY: openssl rand -hex 16
# INNGEST_SIGNING_KEY: openssl rand -hex 32
INNGEST_EVENT_KEY="prod-YOUR_32_CHAR_HEX_KEY_HERE"
INNGEST_SIGNING_KEY="YOUR_64_CHAR_HEX_KEY_HERE"

# Internal Docker network URL (don't change unless customizing)
INNGEST_BASE_URL="http://inngest:8288"

# ============================================
# SCALING CONFIGURATION
# ============================================
# Number of server replicas (match your --scale server=N value)
SERVER_REPLICAS="6"
# Parallel tasks per server instance
INNGEST_PARALLELISM_PER_SERVER="10"

# Total concurrency = INNGEST_PARALLELISM_PER_SERVER * SERVER_REPLICAS
# Example: 10 * 6 = 60 concurrent tasks

# ============================================
# REDIS (REQUIRED FOR PRODUCTION)
# ============================================
# Internal Docker: redis://redis:6379
# External Redis: redis://your-redis-host:6379
REDIS_URL="redis://redis:6379"

# ============================================
# WEBHOOK CONFIGURATION
# ============================================
# Your frontend webhook endpoint
FRONTEND_WEBHOOK_URL="https://your-frontend-domain.com/api/webhooks"
WEBHOOK_SECRET="your-webhook-secret-key"
WEBHOOK_TIMEOUT="10000"
WEBHOOK_MAX_ATTEMPTS="3"

# SSRF protection: allowed webhook origins
WEBHOOK_ALLOWED_ORIGINS="https://your-frontend-domain.com,https://app.your-domain.com"

# ============================================
# SERVER CONFIGURATION
# ============================================
PORT="3002"
# Internal port for load balancer (don't change)
SERVER_PORT="3002"

# ============================================
# INNGEST PORTS (localhost only for security)
# ============================================
INNGEST_PORT="8288"
INNGEST_CONNECT_PORT="8289"

# ============================================
# REDIS PORT (localhost only for security)
# ============================================
REDIS_PORT="6379"

# ============================================
# AUTOMATION SCHEDULER
# ============================================
# Cron schedule for automation checks (every minute by default)
AUTOMATION_SCHEDULER_CRON="*/1 * * * *"
# Window for "due" detection
AUTOMATION_SCHEDULER_WINDOW_MINUTES="20"

# ============================================
# OPTIONAL: ADVANCED CONCURRENCY TUNING
# ============================================
# Global workflow concurrency limits (across all replicas)
# AUDIT_RUN_CONCURRENCY="60"
# TRANSCRIPTION_FICHE_CONCURRENCY="60"
# FICHE_FETCH_CONCURRENCY="60"
# AUDIT_STEP_WORKER_CONCURRENCY="60"
# TRANSCRIPTION_RECORDING_WORKER_CONCURRENCY="60"
# TRANSCRIPTION_FINALIZER_CONCURRENCY="60"
# BATCH_AUDIT_PROGRESS_CONCURRENCY="60"
# PROGRESSIVE_FETCH_DAY_CONCURRENCY="60"

# Per-entity concurrency limits
# AUDIT_RUN_PER_FICHE_CONCURRENCY="1"
# AUDIT_STEP_PER_AUDIT_CONCURRENCY="10"
# TRANSCRIPTION_RECORDING_PER_FICHE_CONCURRENCY="10"

# In-process parallelism (per server instance)
# AUDIT_STEP_CONCURRENCY="10"
# TRANSCRIPTION_RECORDING_CONCURRENCY="10"
# FICHE_SALES_CACHE_CONCURRENCY="10"
# TRANSCRIPTION_PROGRESS_WEBHOOK_FREQUENCY="3"
# TRANSCRIPTION_RUN_STATE_TTL_SECONDS="7200"
# TRANSCRIPTION_LOCK_TTL_MS="1800000"
# AUDIT_BATCH_STATE_TTL_SECONDS="21600"
# AUTOMATION_FICHE_FETCH_CONCURRENCY="5"

