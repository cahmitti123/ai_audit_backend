{
    "openapi":  "3.0.0",
    "info":  {
                 "title":  "AI Audit System API",
                 "version":  "2.3.0",
                 "description":  "REST API for AI-powered quality audit system with GPT-5",
                 "contact":  {
                                 "name":  "API Support"
                             }
             },
    "servers":  [
                    {
                        "url":  "http://localhost:3002",
                        "description":  "Development server"
                    }
                ],
    "tags":  [
                 {
                     "name":  "Health",
                     "description":  "Health check endpoints"
                 },
                 {
                     "name":  "Fiches",
                     "description":  "Fiche data and caching"
                 },
                 {
                     "name":  "Recordings",
                     "description":  "Recording management"
                 },
                 {
                     "name":  "Transcriptions",
                     "description":  "Audio transcription"
                 },
                 {
                     "name":  "Audit Configs",
                     "description":  "Audit configuration management"
                 },
                 {
                     "name":  "Audits",
                     "description":  "Audit execution and results"
                 },
                 {
                     "name":  "Products",
                     "description":  "Insurance products management"
                 }
             ],
    "paths":  {
                  "/api/audit-configs":  {
                                             "get":  {
                                                         "tags":  [
                                                                      "Audit Configs"
                                                                  ],
                                                         "summary":  "List all audit configurations",
                                                         "parameters":  [
                                                                            {
                                                                                "name":  "include_inactive",
                                                                                "in":  "query",
                                                                                "schema":  {
                                                                                               "type":  "boolean"
                                                                                           }
                                                                            },
                                                                            {
                                                                                "name":  "include_steps",
                                                                                "in":  "query",
                                                                                "schema":  {
                                                                                               "type":  "boolean"
                                                                                           }
                                                                            },
                                                                            {
                                                                                "name":  "include_stats",
                                                                                "in":  "query",
                                                                                "schema":  {
                                                                                               "type":  "boolean"
                                                                                           }
                                                                            }
                                                                        ]
                                                     },
                                             "post":  {
                                                          "tags":  [
                                                                       "Audit Configs"
                                                                   ],
                                                          "summary":  "Create new audit configuration (atomic transaction)",
                                                          "description":  "Creates audit config with all steps in a single transaction. All or nothing."
                                                      }
                                         },
                  "/api/audit-configs/{id}":  {
                                                  "get":  {
                                                              "tags":  [
                                                                           "Audit Configs"
                                                                       ],
                                                              "summary":  "Get audit configuration details",
                                                              "parameters":  [
                                                                                 {
                                                                                     "name":  "id",
                                                                                     "in":  "path",
                                                                                     "required":  true,
                                                                                     "schema":  {
                                                                                                    "type":  "string"
                                                                                                }
                                                                                 },
                                                                                 {
                                                                                     "name":  "include_stats",
                                                                                     "in":  "query",
                                                                                     "schema":  {
                                                                                                    "type":  "boolean"
                                                                                                }
                                                                                 }
                                                                             ]
                                                          },
                                                  "put":  {
                                                              "tags":  [
                                                                           "Audit Configs"
                                                                       ],
                                                              "summary":  "Update audit configuration"
                                                          },
                                                  "delete":  {
                                                                 "tags":  [
                                                                              "Audit Configs"
                                                                          ],
                                                                 "summary":  "Delete audit configuration"
                                                             }
                                              },
                  "/api/audit-configs/{config_id}/steps":  {
                                                               "post":  {
                                                                            "tags":  [
                                                                                         "Audit Configs"
                                                                                     ],
                                                                            "summary":  "Add step to audit configuration"
                                                                        }
                                                           },
                  "/api/audit-steps/{step_id}":  {
                                                     "put":  {
                                                                 "tags":  [
                                                                              "Audit Configs"
                                                                          ],
                                                                 "summary":  "Update audit step"
                                                             },
                                                     "delete":  {
                                                                    "tags":  [
                                                                                 "Audit Configs"
                                                                             ],
                                                                    "summary":  "Delete audit step"
                                                                }
                                                 },
                  "/api/audit-configs/{config_id}/steps/reorder":  {
                                                                       "put":  {
                                                                                   "tags":  [
                                                                                                "Audit Configs"
                                                                                            ],
                                                                                   "summary":  "Reorder steps in an audit configuration"
                                                                               }
                                                                   },
                  "/api/audit-configs/{config_id}/validate":  {
                                                                  "get":  {
                                                                              "tags":  [
                                                                                           "Audit Configs"
                                                                                       ],
                                                                              "summary":  "Validate audit config for running"
                                                                          }
                                                              },
                  "/api/audit-configs/{config_id}/stats":  {
                                                               "get":  {
                                                                           "tags":  [
                                                                                        "Audit Configs"
                                                                                    ],
                                                                           "summary":  "Get audit config usage statistics"
                                                                       }
                                                           },
                  "/api/audits/{audit_id}/steps/{step_position}/rerun":  {
                                                                             "post":  {
                                                                                          "tags":  [
                                                                                                       "Audits"
                                                                                                   ],
                                                                                          "summary":  "Re-run a single audit step",
                                                                                          "description":  "Queues async re-analysis of a specific audit step.\nReturns immediately with event_id for tracking.\nResults sent via webhook when complete.\n\nProcess:\n1. Queues Inngest job\n2. Returns event_id immediately\n3. Job regenerates timeline from DB\n4. Re-links to product database\n5. Re-analyzes step with optional custom prompt\n6. Sends webhook with comparison results\n",
                                                                                          "parameters":  [
                                                                                                             {
                                                                                                                 "in":  "path",
                                                                                                                 "name":  "audit_id",
                                                                                                                 "required":  true,
                                                                                                                 "schema":  {
                                                                                                                                "type":  "string"
                                                                                                                            },
                                                                                                                 "description":  "The audit database ID"
                                                                                                             },
                                                                                                             {
                                                                                                                 "in":  "path",
                                                                                                                 "name":  "step_position",
                                                                                                                 "required":  true,
                                                                                                                 "schema":  {
                                                                                                                                "type":  "integer"
                                                                                                                            },
                                                                                                                 "description":  "Step position (1-17)"
                                                                                                             }
                                                                                                         ],
                                                                                          "requestBody":  {
                                                                                                              "content":  {
                                                                                                                              "application/json":  {
                                                                                                                                                       "schema":  {
                                                                                                                                                                      "type":  "object",
                                                                                                                                                                      "properties":  {
                                                                                                                                                                                         "customPrompt":  {
                                                                                                                                                                                                              "type":  "string",
                                                                                                                                                                                                              "description":  "Additional instructions for the AI analyzer",
                                                                                                                                                                                                              "example":  "Focus specifically on whether the agent mentioned Bloctel compliance in the first 2 minutes"
                                                                                                                                                                                                          },
                                                                                                                                                                                         "customInstructions":  {
                                                                                                                                                                                                                    "type":  "string",
                                                                                                                                                                                                                    "description":  "Alternative field for custom instructions"
                                                                                                                                                                                                                }
                                                                                                                                                                                     }
                                                                                                                                                                  },
                                                                                                                                                       "examples":  {
                                                                                                                                                                        "basic":  {
                                                                                                                                                                                      "summary":  "Basic re-run",
                                                                                                                                                                                      "value":  {

                                                                                                                                                                                                }
                                                                                                                                                                                  },
                                                                                                                                                                        "with_guidance":  {
                                                                                                                                                                                              "summary":  "With custom instructions",
                                                                                                                                                                                              "value":  {
                                                                                                                                                                                                            "customPrompt":  "Please verify if the agent mentioned the cooling-off period, even if not explicitly using those words"
                                                                                                                                                                                                        }
                                                                                                                                                                                          }
                                                                                                                                                                    }
                                                                                                                                                   }
                                                                                                                          }
                                                                                                          },
                                                                                          "responses":  {
                                                                                                            "200":  {
                                                                                                                        "description":  "Re-run job queued successfully",
                                                                                                                        "content":  {
                                                                                                                                        "application/json":  {
                                                                                                                                                                 "schema":  {
                                                                                                                                                                                "type":  "object",
                                                                                                                                                                                "properties":  {
                                                                                                                                                                                                   "success":  {
                                                                                                                                                                                                                   "type":  "boolean"
                                                                                                                                                                                                               },
                                                                                                                                                                                                   "message":  {
                                                                                                                                                                                                                   "type":  "string"
                                                                                                                                                                                                               },
                                                                                                                                                                                                   "event_id":  {
                                                                                                                                                                                                                    "type":  "string",
                                                                                                                                                                                                                    "description":  "Inngest event ID for tracking"
                                                                                                                                                                                                                },
                                                                                                                                                                                                   "audit_id":  {
                                                                                                                                                                                                                    "type":  "string"
                                                                                                                                                                                                                },
                                                                                                                                                                                                   "step_position":  {
                                                                                                                                                                                                                         "type":  "integer"
                                                                                                                                                                                                                     }
                                                                                                                                                                                               }
                                                                                                                                                                            }
                                                                                                                                                             }
                                                                                                                                    }
                                                                                                                    },
                                                                                                            "404":  {
                                                                                                                        "description":  "Audit or step not found"
                                                                                                                    },
                                                                                                            "500":  {
                                                                                                                        "description":  "Re-run failed"
                                                                                                                    }
                                                                                                        }
                                                                                      }
                                                                         },
                  "/api/audits":  {
                                      "get":  {
                                                  "tags":  [
                                                               "Audits"
                                                           ],
                                                  "summary":  "List all audits with advanced filtering and sorting",
                                                  "description":  "Retrieve audits across all fiches with comprehensive filtering options.\nSupports pagination, date ranges, status filtering, and multiple sort options.\n",
                                                  "parameters":  [
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "fiche_ids",
                                                                         "schema":  {
                                                                                        "type":  "string"
                                                                                    },
                                                                         "description":  "Comma-separated list of fiche IDs to filter by",
                                                                         "example":  "1762209,1753254"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "status",
                                                                         "schema":  {
                                                                                        "type":  "string"
                                                                                    },
                                                                         "description":  "Comma-separated list of statuses (pending, running, completed, failed)",
                                                                         "example":  "completed,failed"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "is_compliant",
                                                                         "schema":  {
                                                                                        "type":  "boolean"
                                                                                    },
                                                                         "description":  "Filter by compliance status",
                                                                         "example":  true
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "date_from",
                                                                         "schema":  {
                                                                                        "type":  "string",
                                                                                        "format":  "date"
                                                                                    },
                                                                         "description":  "Start date (ISO 8601)",
                                                                         "example":  "2025-01-01"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "date_to",
                                                                         "schema":  {
                                                                                        "type":  "string",
                                                                                        "format":  "date"
                                                                                    },
                                                                         "description":  "End date (ISO 8601)",
                                                                         "example":  "2025-01-31"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "audit_config_ids",
                                                                         "schema":  {
                                                                                        "type":  "string"
                                                                                    },
                                                                         "description":  "Comma-separated list of audit config IDs",
                                                                         "example":  "13,11"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "sort_by",
                                                                         "schema":  {
                                                                                        "type":  "string",
                                                                                        "enum":  [
                                                                                                     "created_at",
                                                                                                     "completed_at",
                                                                                                     "score_percentage",
                                                                                                     "duration_ms"
                                                                                                 ]
                                                                                    },
                                                                         "description":  "Field to sort by",
                                                                         "example":  "created_at"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "sort_order",
                                                                         "schema":  {
                                                                                        "type":  "string",
                                                                                        "enum":  [
                                                                                                     "asc",
                                                                                                     "desc"
                                                                                                 ]
                                                                                    },
                                                                         "description":  "Sort order",
                                                                         "example":  "desc"
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "limit",
                                                                         "schema":  {
                                                                                        "type":  "integer"
                                                                                    },
                                                                         "description":  "Number of results per page (max 500)",
                                                                         "example":  50
                                                                     },
                                                                     {
                                                                         "in":  "query",
                                                                         "name":  "offset",
                                                                         "schema":  {
                                                                                        "type":  "integer"
                                                                                    },
                                                                         "description":  "Number of results to skip for pagination",
                                                                         "example":  0
                                                                     }
                                                                 ],
                                                  "responses":  {
                                                                    "200":  {
                                                                                "description":  "List of audits with pagination info"
                                                                            },
                                                                    "400":  {
                                                                                "description":  "Invalid query parameters"
                                                                            },
                                                                    "500":  {
                                                                                "description":  "Server error"
                                                                            }
                                                                }
                                              }
                                  },
                  "/api/audits/grouped-by-fiches":  {
                                                        "get":  {
                                                                    "tags":  [
                                                                                 "Audits"
                                                                             ],
                                                                    "summary":  "Get audits grouped by fiches",
                                                                    "description":  "Retrieve audits organized by fiche with complete fiche information.\nEach entry contains fiche details, all associated audits, and summary statistics.\nSupports the same filtering options as the main audits list endpoint.\n",
                                                                    "parameters":  [
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "fiche_ids",
                                                                                           "schema":  {
                                                                                                          "type":  "string"
                                                                                                      },
                                                                                           "description":  "Comma-separated list of fiche IDs to filter by",
                                                                                           "example":  "1762209,1753254"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "status",
                                                                                           "schema":  {
                                                                                                          "type":  "string"
                                                                                                      },
                                                                                           "description":  "Comma-separated list of statuses (pending, running, completed, failed)",
                                                                                           "example":  "completed,failed"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "is_compliant",
                                                                                           "schema":  {
                                                                                                          "type":  "boolean"
                                                                                                      },
                                                                                           "description":  "Filter by compliance status",
                                                                                           "example":  true
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "date_from",
                                                                                           "schema":  {
                                                                                                          "type":  "string",
                                                                                                          "format":  "date"
                                                                                                      },
                                                                                           "description":  "Start date (ISO 8601)",
                                                                                           "example":  "2025-01-01"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "date_to",
                                                                                           "schema":  {
                                                                                                          "type":  "string",
                                                                                                          "format":  "date"
                                                                                                      },
                                                                                           "description":  "End date (ISO 8601)",
                                                                                           "example":  "2025-01-31"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "audit_config_ids",
                                                                                           "schema":  {
                                                                                                          "type":  "string"
                                                                                                      },
                                                                                           "description":  "Comma-separated list of audit config IDs",
                                                                                           "example":  "13,11"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "sort_by",
                                                                                           "schema":  {
                                                                                                          "type":  "string",
                                                                                                          "enum":  [
                                                                                                                       "created_at",
                                                                                                                       "completed_at",
                                                                                                                       "score_percentage",
                                                                                                                       "duration_ms"
                                                                                                                   ]
                                                                                                      },
                                                                                           "description":  "Field to sort audits by within each fiche",
                                                                                           "example":  "created_at"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "sort_order",
                                                                                           "schema":  {
                                                                                                          "type":  "string",
                                                                                                          "enum":  [
                                                                                                                       "asc",
                                                                                                                       "desc"
                                                                                                                   ]
                                                                                                      },
                                                                                           "description":  "Sort order for audits",
                                                                                           "example":  "desc"
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "limit",
                                                                                           "schema":  {
                                                                                                          "type":  "integer"
                                                                                                      },
                                                                                           "description":  "Number of fiches per page (max 500)",
                                                                                           "example":  50
                                                                                       },
                                                                                       {
                                                                                           "in":  "query",
                                                                                           "name":  "offset",
                                                                                           "schema":  {
                                                                                                          "type":  "integer"
                                                                                                      },
                                                                                           "description":  "Number of fiches to skip for pagination",
                                                                                           "example":  0
                                                                                       }
                                                                                   ],
                                                                    "responses":  {
                                                                                      "200":  {
                                                                                                  "description":  "Audits grouped by fiches with pagination info",
                                                                                                  "content":  {
                                                                                                                  "application/json":  {
                                                                                                                                           "schema":  {
                                                                                                                                                          "type":  "object",
                                                                                                                                                          "properties":  {
                                                                                                                                                                             "success":  {
                                                                                                                                                                                             "type":  "boolean",
                                                                                                                                                                                             "example":  true
                                                                                                                                                                                         },
                                                                                                                                                                             "data":  {
                                                                                                                                                                                          "type":  "array",
                                                                                                                                                                                          "items":  {
                                                                                                                                                                                                        "type":  "object",
                                                                                                                                                                                                        "properties":  {
                                                                                                                                                                                                                           "fiche":  {
                                                                                                                                                                                                                                         "type":  "object",
                                                                                                                                                                                                                                         "description":  "Fiche details"
                                                                                                                                                                                                                                     },
                                                                                                                                                                                                                           "audits":  {
                                                                                                                                                                                                                                          "type":  "array",
                                                                                                                                                                                                                                          "description":  "Array of audits for this fiche"
                                                                                                                                                                                                                                      },
                                                                                                                                                                                                                           "summary":  {
                                                                                                                                                                                                                                           "type":  "object",
                                                                                                                                                                                                                                           "properties":  {
                                                                                                                                                                                                                                                              "totalAudits":  {
                                                                                                                                                                                                                                                                                  "type":  "integer"
                                                                                                                                                                                                                                                                              },
                                                                                                                                                                                                                                                              "compliantCount":  {
                                                                                                                                                                                                                                                                                     "type":  "integer"
                                                                                                                                                                                                                                                                                 },
                                                                                                                                                                                                                                                              "averageScore":  {
                                                                                                                                                                                                                                                                                   "type":  "number"
                                                                                                                                                                                                                                                                               },
                                                                                                                                                                                                                                                              "latestAuditDate":  {
                                                                                                                                                                                                                                                                                      "type":  "string",
                                                                                                                                                                                                                                                                                      "format":  "date-time"
                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                       }
                                                                                                                                                                                                                       }
                                                                                                                                                                                                    }
                                                                                                                                                                                      },
                                                                                                                                                                             "pagination":  {
                                                                                                                                                                                                "type":  "object",
                                                                                                                                                                                                "properties":  {
                                                                                                                                                                                                                   "total":  {
                                                                                                                                                                                                                                 "type":  "integer"
                                                                                                                                                                                                                             },
                                                                                                                                                                                                                   "limit":  {
                                                                                                                                                                                                                                 "type":  "integer"
                                                                                                                                                                                                                             },
                                                                                                                                                                                                                   "offset":  {
                                                                                                                                                                                                                                  "type":  "integer"
                                                                                                                                                                                                                              },
                                                                                                                                                                                                                   "current_page":  {
                                                                                                                                                                                                                                        "type":  "integer"
                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                   "total_pages":  {
                                                                                                                                                                                                                                       "type":  "integer"
                                                                                                                                                                                                                                   },
                                                                                                                                                                                                                   "has_next_page":  {
                                                                                                                                                                                                                                         "type":  "boolean"
                                                                                                                                                                                                                                     },
                                                                                                                                                                                                                   "has_prev_page":  {
                                                                                                                                                                                                                                         "type":  "boolean"
                                                                                                                                                                                                                                     }
                                                                                                                                                                                                               }
                                                                                                                                                                                            }
                                                                                                                                                                         }
                                                                                                                                                      }
                                                                                                                                       }
                                                                                                              }
                                                                                              },
                                                                                      "400":  {
                                                                                                  "description":  "Invalid query parameters"
                                                                                              },
                                                                                      "500":  {
                                                                                                  "description":  "Server error"
                                                                                              }
                                                                                  }
                                                                }
                                                    },
                  "/api/audits/run":  {
                                          "post":  {
                                                       "tags":  [
                                                                    "Audits"
                                                                ],
                                                       "summary":  "Run audit with specific config (async via Inngest)",
                                                       "description":  "Queues an audit job to Inngest for background processing",
                                                       "requestBody":  {
                                                                           "required":  true,
                                                                           "content":  {
                                                                                           "application/json":  {
                                                                                                                    "schema":  {
                                                                                                                                   "type":  "object",
                                                                                                                                   "required":  [
                                                                                                                                                    "audit_id",
                                                                                                                                                    "fiche_id"
                                                                                                                                                ],
                                                                                                                                   "properties":  {
                                                                                                                                                      "audit_id":  {
                                                                                                                                                                       "type":  "integer",
                                                                                                                                                                       "description":  "Audit configuration ID",
                                                                                                                                                                       "example":  13
                                                                                                                                                                   },
                                                                                                                                                      "fiche_id":  {
                                                                                                                                                                       "type":  "string",
                                                                                                                                                                       "description":  "Fiche identifier",
                                                                                                                                                                       "example":  "1762209"
                                                                                                                                                                   },
                                                                                                                                                      "user_id":  {
                                                                                                                                                                      "type":  "string",
                                                                                                                                                                      "description":  "Optional user ID for tracking",
                                                                                                                                                                      "example":  "user_123"
                                                                                                                                                                  }
                                                                                                                                                  }
                                                                                                                               }
                                                                                                                }
                                                                                       }
                                                                       },
                                                       "responses":  {
                                                                         "200":  {
                                                                                     "description":  "Audit queued successfully",
                                                                                     "content":  {
                                                                                                     "application/json":  {
                                                                                                                              "schema":  {
                                                                                                                                             "type":  "object",
                                                                                                                                             "properties":  {
                                                                                                                                                                "success":  {
                                                                                                                                                                                "type":  "boolean",
                                                                                                                                                                                "example":  true
                                                                                                                                                                            },
                                                                                                                                                                "message":  {
                                                                                                                                                                                "type":  "string",
                                                                                                                                                                                "example":  "Audit queued for processing"
                                                                                                                                                                            },
                                                                                                                                                                "event_id":  {
                                                                                                                                                                                 "type":  "string",
                                                                                                                                                                                 "example":  "01K860XNK05HRDNK6P9A44MTZX"
                                                                                                                                                                             },
                                                                                                                                                                "fiche_id":  {
                                                                                                                                                                                 "type":  "string"
                                                                                                                                                                             },
                                                                                                                                                                "audit_config_id":  {
                                                                                                                                                                                        "type":  "integer"
                                                                                                                                                                                    },
                                                                                                                                                                "metadata":  {
                                                                                                                                                                                 "type":  "object",
                                                                                                                                                                                 "properties":  {
                                                                                                                                                                                                    "timestamp":  {
                                                                                                                                                                                                                      "type":  "string"
                                                                                                                                                                                                                  },
                                                                                                                                                                                                    "status":  {
                                                                                                                                                                                                                   "type":  "string",
                                                                                                                                                                                                                   "example":  "queued"
                                                                                                                                                                                                               }
                                                                                                                                                                                                }
                                                                                                                                                                             }
                                                                                                                                                            }
                                                                                                                                         }
                                                                                                                          }
                                                                                                 }
                                                                                 },
                                                                         "400":  {
                                                                                     "description":  "Missing required parameters"
                                                                                 },
                                                                         "500":  {
                                                                                     "description":  "Failed to queue audit"
                                                                                 }
                                                                     }
                                                   }
                                      },
                  "/api/audits/run-latest":  {
                                                 "post":  {
                                                              "tags":  [
                                                                           "Audits"
                                                                       ],
                                                              "summary":  "Run audit with latest active config (async via Inngest)",
                                                              "description":  "Queues an audit job using the latest active configuration",
                                                              "requestBody":  {
                                                                                  "required":  true,
                                                                                  "content":  {
                                                                                                  "application/json":  {
                                                                                                                           "schema":  {
                                                                                                                                          "type":  "object",
                                                                                                                                          "required":  [
                                                                                                                                                           "fiche_id"
                                                                                                                                                       ],
                                                                                                                                          "properties":  {
                                                                                                                                                             "fiche_id":  {
                                                                                                                                                                              "type":  "string",
                                                                                                                                                                              "description":  "Fiche identifier",
                                                                                                                                                                              "example":  "1762209"
                                                                                                                                                                          },
                                                                                                                                                             "user_id":  {
                                                                                                                                                                             "type":  "string",
                                                                                                                                                                             "description":  "Optional user ID for tracking",
                                                                                                                                                                             "example":  "user_123"
                                                                                                                                                                         }
                                                                                                                                                         }
                                                                                                                                      }
                                                                                                                       }
                                                                                              }
                                                                              },
                                                              "responses":  {
                                                                                "200":  {
                                                                                            "description":  "Audit queued successfully"
                                                                                        },
                                                                                "400":  {
                                                                                            "description":  "Missing fiche_id parameter"
                                                                                        },
                                                                                "404":  {
                                                                                            "description":  "No active audit configuration found"
                                                                                        },
                                                                                "500":  {
                                                                                            "description":  "Failed to queue audit"
                                                                                        }
                                                                            }
                                                          }
                                             },
                  "/api/audits/batch":  {
                                            "post":  {
                                                         "tags":  [
                                                                      "Audits"
                                                                  ],
                                                         "summary":  "Batch run audits for multiple fiches",
                                                         "description":  "Queues multiple audit jobs in parallel using Inngest fan-out pattern",
                                                         "requestBody":  {
                                                                             "required":  true,
                                                                             "content":  {
                                                                                             "application/json":  {
                                                                                                                      "schema":  {
                                                                                                                                     "type":  "object",
                                                                                                                                     "required":  [
                                                                                                                                                      "fiche_ids"
                                                                                                                                                  ],
                                                                                                                                     "properties":  {
                                                                                                                                                        "fiche_ids":  {
                                                                                                                                                                          "type":  "array",
                                                                                                                                                                          "items":  {
                                                                                                                                                                                        "type":  "string"
                                                                                                                                                                                    },
                                                                                                                                                                          "description":  "Array of fiche identifiers",
                                                                                                                                                                          "example":  [
                                                                                                                                                                                          "1762209",
                                                                                                                                                                                          "1753254"
                                                                                                                                                                                      ]
                                                                                                                                                                      },
                                                                                                                                                        "audit_config_id":  {
                                                                                                                                                                                "type":  "integer",
                                                                                                                                                                                "description":  "Audit configuration ID (defaults to 10 if not provided)",
                                                                                                                                                                                "example":  13
                                                                                                                                                                            },
                                                                                                                                                        "user_id":  {
                                                                                                                                                                        "type":  "string",
                                                                                                                                                                        "description":  "Optional user ID for tracking",
                                                                                                                                                                        "example":  "user_123"
                                                                                                                                                                    }
                                                                                                                                                    }
                                                                                                                                 }
                                                                                                                  }
                                                                                         }
                                                                         },
                                                         "responses":  {
                                                                           "200":  {
                                                                                       "description":  "Batch audit queued successfully"
                                                                                   },
                                                                           "400":  {
                                                                                       "description":  "Invalid request - fiche_ids array required"
                                                                                   },
                                                                           "500":  {
                                                                                       "description":  "Failed to queue batch audit"
                                                                                   }
                                                                       }
                                                     }
                                        },
                  "/api/audits/by-fiche/{fiche_id}":  {
                                                          "get":  {
                                                                      "tags":  [
                                                                                   "Audits"
                                                                               ],
                                                                      "summary":  "Get audit history for a fiche"
                                                                  }
                                                      },
                  "/api/audits/{audit_id}":  {
                                                 "get":  {
                                                             "tags":  [
                                                                          "Audits"
                                                                      ],
                                                             "summary":  "Get detailed audit results"
                                                         }
                                             },
                  "/api/automation/schedules":  {
                                                    "post":  {
                                                                 "summary":  "Create automation schedule",
                                                                 "tags":  [
                                                                              "Automation"
                                                                          ]
                                                             },
                                                    "get":  {
                                                                "summary":  "List all automation schedules",
                                                                "tags":  [
                                                                             "Automation"
                                                                         ]
                                                            }
                                                },
                  "/api/automation/schedules/{id}":  {
                                                         "get":  {
                                                                     "summary":  "Get automation schedule by ID",
                                                                     "tags":  [
                                                                                  "Automation"
                                                                              ]
                                                                 },
                                                         "patch":  {
                                                                       "summary":  "Update automation schedule",
                                                                       "tags":  [
                                                                                    "Automation"
                                                                                ]
                                                                   },
                                                         "delete":  {
                                                                        "summary":  "Delete automation schedule",
                                                                        "tags":  [
                                                                                     "Automation"
                                                                                 ]
                                                                    }
                                                     },
                  "/api/automation/trigger":  {
                                                  "post":  {
                                                               "summary":  "Trigger automation schedule manually",
                                                               "tags":  [
                                                                            "Automation"
                                                                        ]
                                                           }
                                              },
                  "/api/automation/diagnostic":  {
                                                     "get":  {
                                                                 "summary":  "Get Inngest configuration diagnostic",
                                                                 "tags":  [
                                                                              "Automation"
                                                                          ]
                                                             }
                                                 },
                  "/api/automation/schedules/{id}/runs":  {
                                                              "get":  {
                                                                          "summary":  "Get runs for a schedule",
                                                                          "tags":  [
                                                                                       "Automation"
                                                                                   ]
                                                                      }
                                                          },
                  "/api/automation/runs/{id}":  {
                                                    "get":  {
                                                                "summary":  "Get automation run by ID",
                                                                "tags":  [
                                                                             "Automation"
                                                                         ]
                                                            }
                                                },
                  "/api/automation/runs/{id}/logs":  {
                                                         "get":  {
                                                                     "summary":  "Get logs for an automation run",
                                                                     "tags":  [
                                                                                  "Automation"
                                                                              ]
                                                                 }
                                                     },
                  "/api/audits/{audit_id}/chat/history":  {
                                                              "get":  {
                                                                          "tags":  [
                                                                                       "Chat"
                                                                                   ],
                                                                          "summary":  "Get chat conversation history for an audit",
                                                                          "parameters":  [
                                                                                             {
                                                                                                 "in":  "path",
                                                                                                 "name":  "audit_id",
                                                                                                 "required":  true,
                                                                                                 "schema":  {
                                                                                                                "type":  "string"
                                                                                                            }
                                                                                             }
                                                                                         ],
                                                                          "responses":  {
                                                                                            "200":  {
                                                                                                        "description":  "Chat conversation history"
                                                                                                    },
                                                                                            "404":  {
                                                                                                        "description":  "Audit not found"
                                                                                                    }
                                                                                        }
                                                                      }
                                                          },
                  "/api/audits/{audit_id}/chat":  {
                                                      "post":  {
                                                                   "tags":  [
                                                                                "Chat"
                                                                            ],
                                                                   "summary":  "Chat about a specific audit (streaming)",
                                                                   "parameters":  [
                                                                                      {
                                                                                          "in":  "path",
                                                                                          "name":  "audit_id",
                                                                                          "required":  true,
                                                                                          "schema":  {
                                                                                                         "type":  "string"
                                                                                                     }
                                                                                      }
                                                                                  ],
                                                                   "requestBody":  {
                                                                                       "required":  true,
                                                                                       "content":  {
                                                                                                       "application/json":  {
                                                                                                                                "schema":  {
                                                                                                                                               "type":  "object",
                                                                                                                                               "required":  [
                                                                                                                                                                "message"
                                                                                                                                                            ],
                                                                                                                                               "properties":  {
                                                                                                                                                                  "message":  {
                                                                                                                                                                                  "type":  "string"
                                                                                                                                                                              }
                                                                                                                                                              }
                                                                                                                                           }
                                                                                                                            }
                                                                                                   }
                                                                                   },
                                                                   "responses":  {
                                                                                     "200":  {
                                                                                                 "description":  "SSE stream of AI response",
                                                                                                 "content":  {
                                                                                                                 "text/event-stream":  {

                                                                                                                                       }
                                                                                                             }
                                                                                             }
                                                                                 }
                                                               }
                                                  },
                  "/api/fiches/{fiche_id}/chat/history":  {
                                                              "get":  {
                                                                          "tags":  [
                                                                                       "Chat"
                                                                                   ],
                                                                          "summary":  "Get chat conversation history for a fiche",
                                                                          "parameters":  [
                                                                                             {
                                                                                                 "in":  "path",
                                                                                                 "name":  "fiche_id",
                                                                                                 "required":  true,
                                                                                                 "schema":  {
                                                                                                                "type":  "string"
                                                                                                            }
                                                                                             }
                                                                                         ],
                                                                          "responses":  {
                                                                                            "200":  {
                                                                                                        "description":  "Chat conversation history"
                                                                                                    },
                                                                                            "404":  {
                                                                                                        "description":  "No conversation found"
                                                                                                    }
                                                                                        }
                                                                      }
                                                          },
                  "/api/fiches/{fiche_id}/chat":  {
                                                      "post":  {
                                                                   "tags":  [
                                                                                "Chat"
                                                                            ],
                                                                   "summary":  "Chat about a fiche and all its audits (streaming)",
                                                                   "parameters":  [
                                                                                      {
                                                                                          "in":  "path",
                                                                                          "name":  "fiche_id",
                                                                                          "required":  true,
                                                                                          "schema":  {
                                                                                                         "type":  "string"
                                                                                                     }
                                                                                      }
                                                                                  ],
                                                                   "requestBody":  {
                                                                                       "required":  true,
                                                                                       "content":  {
                                                                                                       "application/json":  {
                                                                                                                                "schema":  {
                                                                                                                                               "type":  "object",
                                                                                                                                               "required":  [
                                                                                                                                                                "message"
                                                                                                                                                            ],
                                                                                                                                               "properties":  {
                                                                                                                                                                  "message":  {
                                                                                                                                                                                  "type":  "string"
                                                                                                                                                                              }
                                                                                                                                                              }
                                                                                                                                           }
                                                                                                                            }
                                                                                                   }
                                                                                   },
                                                                   "responses":  {
                                                                                     "200":  {
                                                                                                 "description":  "SSE stream of AI response with citations"
                                                                                             }
                                                                                 }
                                                               }
                                                  },
                  "/api/fiches/search":  {
                                             "get":  {
                                                         "tags":  [
                                                                      "Fiches"
                                                                  ],
                                                         "summary":  "Search fiches by date with status information",
                                                         "parameters":  [
                                                                            {
                                                                                "in":  "query",
                                                                                "name":  "date",
                                                                                "required":  true,
                                                                                "schema":  {
                                                                                               "type":  "string",
                                                                                               "format":  "date"
                                                                                           },
                                                                                "description":  "Date in YYYY-MM-DD format"
                                                                            },
                                                                            {
                                                                                "in":  "query",
                                                                                "name":  "includeStatus",
                                                                                "schema":  {
                                                                                               "type":  "boolean",
                                                                                               "default":  true
                                                                                           },
                                                                                "description":  "Include transcription and audit status"
                                                                            }
                                                                        ],
                                                         "responses":  {
                                                                           "200":  {
                                                                                       "description":  "List of fiches with status information"
                                                                                   }
                                                                       }
                                                     }
                                         },
                  "/api/fiches/{fiche_id}":  {
                                                 "get":  {
                                                             "tags":  [
                                                                          "Fiches"
                                                                      ],
                                                             "summary":  "Get fiche details with recordings (auto-cached or force refresh)",
                                                             "parameters":  [
                                                                                {
                                                                                    "in":  "path",
                                                                                    "name":  "fiche_id",
                                                                                    "required":  true,
                                                                                    "schema":  {
                                                                                                   "type":  "string"
                                                                                               }
                                                                                },
                                                                                {
                                                                                    "in":  "query",
                                                                                    "name":  "refresh",
                                                                                    "schema":  {
                                                                                                   "type":  "string"
                                                                                               },
                                                                                    "description":  "Set to \"true\" to force refresh from external API and upsert to database"
                                                                                }
                                                                            ],
                                                             "responses":  {
                                                                               "200":  {
                                                                                           "description":  "Fiche details"
                                                                                       }
                                                                           }
                                                         }
                                             },
                  "/api/fiches/{fiche_id}/cache":  {
                                                       "get":  {
                                                                   "tags":  [
                                                                                "Fiches"
                                                                            ],
                                                                   "summary":  "Get cached fiche data",
                                                                   "parameters":  [
                                                                                      {
                                                                                          "in":  "path",
                                                                                          "name":  "fiche_id",
                                                                                          "required":  true,
                                                                                          "schema":  {
                                                                                                         "type":  "string"
                                                                                                     }
                                                                                      }
                                                                                  ],
                                                                   "responses":  {
                                                                                     "200":  {
                                                                                                 "description":  "Cached fiche data"
                                                                                             },
                                                                                     "404":  {
                                                                                                 "description":  "Not cached"
                                                                                             }
                                                                                 }
                                                               }
                                                   },
                  "/api/fiches/{fiche_id}/status":  {
                                                        "get":  {
                                                                    "tags":  [
                                                                                 "Fiches"
                                                                             ],
                                                                    "summary":  "Get fiche status (transcription and audit info)",
                                                                    "parameters":  [
                                                                                       {
                                                                                           "in":  "path",
                                                                                           "name":  "fiche_id",
                                                                                           "required":  true,
                                                                                           "schema":  {
                                                                                                          "type":  "string"
                                                                                                      }
                                                                                       }
                                                                                   ],
                                                                    "responses":  {
                                                                                      "200":  {
                                                                                                  "description":  "Fiche status information"
                                                                                              },
                                                                                      "404":  {
                                                                                                  "description":  "Fiche not found in database"
                                                                                              }
                                                                                  }
                                                                }
                                                    },
                  "/api/fiches/status/batch":  {
                                                   "post":  {
                                                                "tags":  [
                                                                             "Fiches"
                                                                         ],
                                                                "summary":  "Get status for multiple fiches",
                                                                "requestBody":  {
                                                                                    "required":  true,
                                                                                    "content":  {
                                                                                                    "application/json":  {
                                                                                                                             "schema":  {
                                                                                                                                            "type":  "object",
                                                                                                                                            "properties":  {
                                                                                                                                                               "ficheIds":  {
                                                                                                                                                                                "type":  "array",
                                                                                                                                                                                "items":  {
                                                                                                                                                                                              "type":  "string"
                                                                                                                                                                                          }
                                                                                                                                                                            }
                                                                                                                                                           }
                                                                                                                                        }
                                                                                                                         }
                                                                                                }
                                                                                },
                                                                "responses":  {
                                                                                  "200":  {
                                                                                              "description":  "Status information for multiple fiches"
                                                                                          }
                                                                              }
                                                            }
                                               },
                  "/api/fiches/status/by-date":  {
                                                     "get":  {
                                                                 "tags":  [
                                                                              "Fiches"
                                                                          ],
                                                                 "summary":  "Get all fiches for a specific date with complete status information",
                                                                 "description":  "Returns all processed fiches for a date with transcription status, audit results, and recording details. Only returns fiches that exist in the database.",
                                                                 "parameters":  [
                                                                                    {
                                                                                        "in":  "query",
                                                                                        "name":  "date",
                                                                                        "required":  true,
                                                                                        "schema":  {
                                                                                                       "type":  "string",
                                                                                                       "format":  "date"
                                                                                                   },
                                                                                        "description":  "Date in YYYY-MM-DD format"
                                                                                    }
                                                                                ],
                                                                 "responses":  {
                                                                                   "200":  {
                                                                                               "description":  "List of fiches with complete status information"
                                                                                           }
                                                                               }
                                                             }
                                                 },
                  "/api/fiches/status/by-date-range":  {
                                                           "get":  {
                                                                       "tags":  [
                                                                                    "Fiches"
                                                                                ],
                                                                       "summary":  "Progressive fetch - returns first available data immediately, continues in background",
                                                                       "description":  "This endpoint uses a progressive loading strategy:\n1. Checks cache for all dates in range\n2. Returns cached data + first missing day immediately\n3. Fetches remaining days in background\n4. Sends webhook notification when complete (if webhookUrl provided)\n",
                                                                       "parameters":  [
                                                                                          {
                                                                                              "in":  "query",
                                                                                              "name":  "startDate",
                                                                                              "required":  true,
                                                                                              "schema":  {
                                                                                                             "type":  "string",
                                                                                                             "format":  "date"
                                                                                                         },
                                                                                              "description":  "Start date in YYYY-MM-DD format"
                                                                                          },
                                                                                          {
                                                                                              "in":  "query",
                                                                                              "name":  "endDate",
                                                                                              "required":  true,
                                                                                              "schema":  {
                                                                                                             "type":  "string",
                                                                                                             "format":  "date"
                                                                                                         },
                                                                                              "description":  "End date in YYYY-MM-DD format"
                                                                                          },
                                                                                          {
                                                                                              "in":  "query",
                                                                                              "name":  "webhookUrl",
                                                                                              "required":  false,
                                                                                              "schema":  {
                                                                                                             "type":  "string",
                                                                                                             "format":  "uri"
                                                                                                         },
                                                                                              "description":  "URL to receive completion notification"
                                                                                          },
                                                                                          {
                                                                                              "in":  "query",
                                                                                              "name":  "webhookSecret",
                                                                                              "required":  false,
                                                                                              "schema":  {
                                                                                                             "type":  "string"
                                                                                                         },
                                                                                              "description":  "Secret for webhook HMAC signature"
                                                                                          }
                                                                                      ],
                                                                       "responses":  {
                                                                                         "200":  {
                                                                                                     "description":  "Progressive response with partial/complete data"
                                                                                                 }
                                                                                     }
                                                                   }
                                                       },
                  "/api/fiches/webhooks/fiches":  {
                                                      "get":  {
                                                                  "tags":  [
                                                                               "Fiches"
                                                                           ],
                                                                  "summary":  "Poll for job updates (used by frontend)",
                                                                  "description":  "Alternative to webhooks - frontend can poll this endpoint for progress",
                                                                  "parameters":  [
                                                                                     {
                                                                                         "in":  "query",
                                                                                         "name":  "jobId",
                                                                                         "required":  true,
                                                                                         "schema":  {
                                                                                                        "type":  "string"
                                                                                                    }
                                                                                     }
                                                                                 ],
                                                                  "responses":  {
                                                                                    "200":  {
                                                                                                "description":  "Job status with partial data"
                                                                                            }
                                                                                }
                                                              }
                                                  },
                  "/api/fiches/jobs/{jobId}":  {
                                                   "get":  {
                                                               "tags":  [
                                                                            "Fiches"
                                                                        ],
                                                               "summary":  "Get progressive fetch job status",
                                                               "parameters":  [
                                                                                  {
                                                                                      "in":  "path",
                                                                                      "name":  "jobId",
                                                                                      "required":  true,
                                                                                      "schema":  {
                                                                                                     "type":  "string"
                                                                                                 }
                                                                                  }
                                                                              ],
                                                               "responses":  {
                                                                                 "200":  {
                                                                                             "description":  "Job status and progress"
                                                                                         }
                                                                             }
                                                           }
                                               },
                  "/api/fiches/jobs":  {
                                           "get":  {
                                                       "tags":  [
                                                                    "Fiches"
                                                                ],
                                                       "summary":  "List progressive fetch jobs",
                                                       "parameters":  [
                                                                          {
                                                                              "in":  "query",
                                                                              "name":  "status",
                                                                              "schema":  {
                                                                                             "type":  "string",
                                                                                             "enum":  [
                                                                                                          "pending",
                                                                                                          "processing",
                                                                                                          "complete",
                                                                                                          "failed"
                                                                                                      ]
                                                                                         }
                                                                          },
                                                                          {
                                                                              "in":  "query",
                                                                              "name":  "limit",
                                                                              "schema":  {
                                                                                             "type":  "integer",
                                                                                             "default":  20
                                                                                         }
                                                                          }
                                                                      ],
                                                       "responses":  {
                                                                         "200":  {
                                                                                     "description":  "List of jobs"
                                                                                 }
                                                                     }
                                                   }
                                       },
                  "/api/products/stats":  {
                                              "get":  {
                                                          "summary":  "Get products statistics",
                                                          "tags":  [
                                                                       "Products"
                                                                   ],
                                                          "responses":  {
                                                                            "200":  {
                                                                                        "description":  "Statistics about insurance products"
                                                                                    }
                                                                        }
                                                      }
                                          },
                  "/api/products/link-fiche/{ficheId}":  {
                                                             "get":  {
                                                                         "summary":  "Link a fiche (sale) to its product formule",
                                                                         "tags":  [
                                                                                      "Products"
                                                                                  ],
                                                                         "parameters":  [
                                                                                            {
                                                                                                "in":  "path",
                                                                                                "name":  "ficheId",
                                                                                                "required":  true,
                                                                                                "schema":  {
                                                                                                               "type":  "string"
                                                                                                           },
                                                                                                "description":  "Fiche ID to link with product"
                                                                                            }
                                                                                        ],
                                                                         "responses":  {
                                                                                           "200":  {
                                                                                                       "description":  "Matched product formule with complete details"
                                                                                                   },
                                                                                           "404":  {
                                                                                                       "description":  "Fiche not found or no matching product"
                                                                                                   }
                                                                                       }
                                                                     }
                                                         },
                  "/api/products/search":  {
                                               "get":  {
                                                           "summary":  "Search across all product types",
                                                           "tags":  [
                                                                        "Products"
                                                                    ],
                                                           "parameters":  [
                                                                              {
                                                                                  "in":  "query",
                                                                                  "name":  "q",
                                                                                  "required":  true,
                                                                                  "schema":  {
                                                                                                 "type":  "string"
                                                                                             },
                                                                                  "description":  "Search query (minimum 2 characters)"
                                                                              }
                                                                          ],
                                                           "responses":  {
                                                                             "200":  {
                                                                                         "description":  "Search results across groupes, gammes, and formules"
                                                                                     }
                                                                         }
                                                       }
                                           },
                  "/api/products/groupes":  {
                                                "get":  {
                                                            "summary":  "List all insurance groups",
                                                            "tags":  [
                                                                         "Products"
                                                                     ],
                                                            "responses":  {
                                                                              "200":  {
                                                                                          "description":  "List of insurance groups"
                                                                                      }
                                                                          }
                                                        },
                                                "post":  {
                                                             "summary":  "Create a new groupe",
                                                             "tags":  [
                                                                          "Products"
                                                                      ],
                                                             "requestBody":  {
                                                                                 "required":  true,
                                                                                 "content":  {
                                                                                                 "application/json":  {
                                                                                                                          "schema":  {
                                                                                                                                         "type":  "object",
                                                                                                                                         "properties":  {
                                                                                                                                                            "code":  {
                                                                                                                                                                         "type":  "string"
                                                                                                                                                                     },
                                                                                                                                                            "libelle":  {
                                                                                                                                                                            "type":  "string"
                                                                                                                                                                        }
                                                                                                                                                        }
                                                                                                                                     }
                                                                                                                      }
                                                                                             }
                                                                             },
                                                             "responses":  {
                                                                               "201":  {
                                                                                           "description":  "Groupe created successfully"
                                                                                       }
                                                                           }
                                                         }
                                            },
                  "/api/products/groupes/{id}":  {
                                                     "get":  {
                                                                 "summary":  "Get groupe details with gammes",
                                                                 "tags":  [
                                                                              "Products"
                                                                          ],
                                                                 "parameters":  [
                                                                                    {
                                                                                        "in":  "path",
                                                                                        "name":  "id",
                                                                                        "required":  true,
                                                                                        "schema":  {
                                                                                                       "type":  "string"
                                                                                                   }
                                                                                    }
                                                                                ],
                                                                 "responses":  {
                                                                                   "200":  {
                                                                                               "description":  "Groupe details with gammes"
                                                                                           }
                                                                               }
                                                             },
                                                     "put":  {
                                                                 "summary":  "Update a groupe",
                                                                 "tags":  [
                                                                              "Products"
                                                                          ],
                                                                 "parameters":  [
                                                                                    {
                                                                                        "in":  "path",
                                                                                        "name":  "id",
                                                                                        "required":  true,
                                                                                        "schema":  {
                                                                                                       "type":  "string"
                                                                                                   }
                                                                                    }
                                                                                ],
                                                                 "requestBody":  {
                                                                                     "required":  true,
                                                                                     "content":  {
                                                                                                     "application/json":  {
                                                                                                                              "schema":  {
                                                                                                                                             "type":  "object"
                                                                                                                                         }
                                                                                                                          }
                                                                                                 }
                                                                                 },
                                                                 "responses":  {
                                                                                   "200":  {
                                                                                               "description":  "Groupe updated successfully"
                                                                                           }
                                                                               }
                                                             },
                                                     "delete":  {
                                                                    "summary":  "Delete a groupe",
                                                                    "tags":  [
                                                                                 "Products"
                                                                             ],
                                                                    "parameters":  [
                                                                                       {
                                                                                           "in":  "path",
                                                                                           "name":  "id",
                                                                                           "required":  true,
                                                                                           "schema":  {
                                                                                                          "type":  "string"
                                                                                                      }
                                                                                       }
                                                                                   ],
                                                                    "responses":  {
                                                                                      "200":  {
                                                                                                  "description":  "Groupe deleted successfully"
                                                                                              }
                                                                                  }
                                                                }
                                                 },
                  "/api/products/gammes":  {
                                               "get":  {
                                                           "summary":  "List gammes with pagination",
                                                           "tags":  [
                                                                        "Products"
                                                                    ],
                                                           "parameters":  [
                                                                              {
                                                                                  "in":  "query",
                                                                                  "name":  "page",
                                                                                  "schema":  {
                                                                                                 "type":  "integer"
                                                                                             }
                                                                              },
                                                                              {
                                                                                  "in":  "query",
                                                                                  "name":  "limit",
                                                                                  "schema":  {
                                                                                                 "type":  "integer"
                                                                                             }
                                                                              },
                                                                              {
                                                                                  "in":  "query",
                                                                                  "name":  "groupeId",
                                                                                  "schema":  {
                                                                                                 "type":  "string"
                                                                                             }
                                                                              },
                                                                              {
                                                                                  "in":  "query",
                                                                                  "name":  "search",
                                                                                  "schema":  {
                                                                                                 "type":  "string"
                                                                                             }
                                                                              }
                                                                          ],
                                                           "responses":  {
                                                                             "200":  {
                                                                                         "description":  "Paginated list of gammes"
                                                                                     }
                                                                         }
                                                       },
                                               "post":  {
                                                            "summary":  "Create a new gamme",
                                                            "tags":  [
                                                                         "Products"
                                                                     ],
                                                            "requestBody":  {
                                                                                "required":  true,
                                                                                "content":  {
                                                                                                "application/json":  {
                                                                                                                         "schema":  {
                                                                                                                                        "type":  "object"
                                                                                                                                    }
                                                                                                                     }
                                                                                            }
                                                                            },
                                                            "responses":  {
                                                                              "201":  {
                                                                                          "description":  "Gamme created successfully"
                                                                                      }
                                                                          }
                                                        }
                                           },
                  "/api/products/gammes/{id}":  {
                                                    "get":  {
                                                                "summary":  "Get gamme details with formules",
                                                                "tags":  [
                                                                             "Products"
                                                                         ],
                                                                "parameters":  [
                                                                                   {
                                                                                       "in":  "path",
                                                                                       "name":  "id",
                                                                                       "required":  true,
                                                                                       "schema":  {
                                                                                                      "type":  "string"
                                                                                                  }
                                                                                   }
                                                                               ],
                                                                "responses":  {
                                                                                  "200":  {
                                                                                              "description":  "Gamme details with formules"
                                                                                          }
                                                                              }
                                                            },
                                                    "put":  {
                                                                "summary":  "Update a gamme",
                                                                "tags":  [
                                                                             "Products"
                                                                         ],
                                                                "parameters":  [
                                                                                   {
                                                                                       "in":  "path",
                                                                                       "name":  "id",
                                                                                       "required":  true,
                                                                                       "schema":  {
                                                                                                      "type":  "string"
                                                                                                  }
                                                                                   }
                                                                               ],
                                                                "responses":  {
                                                                                  "200":  {
                                                                                              "description":  "Gamme updated successfully"
                                                                                          }
                                                                              }
                                                            },
                                                    "delete":  {
                                                                   "summary":  "Delete a gamme",
                                                                   "tags":  [
                                                                                "Products"
                                                                            ],
                                                                   "parameters":  [
                                                                                      {
                                                                                          "in":  "path",
                                                                                          "name":  "id",
                                                                                          "required":  true,
                                                                                          "schema":  {
                                                                                                         "type":  "string"
                                                                                                     }
                                                                                      }
                                                                                  ],
                                                                   "responses":  {
                                                                                     "200":  {
                                                                                                 "description":  "Gamme deleted successfully"
                                                                                             }
                                                                                 }
                                                               }
                                                },
                  "/api/products/formules":  {
                                                 "get":  {
                                                             "summary":  "List formules with pagination",
                                                             "tags":  [
                                                                          "Products"
                                                                      ],
                                                             "parameters":  [
                                                                                {
                                                                                    "in":  "query",
                                                                                    "name":  "page",
                                                                                    "schema":  {
                                                                                                   "type":  "integer"
                                                                                               }
                                                                                },
                                                                                {
                                                                                    "in":  "query",
                                                                                    "name":  "limit",
                                                                                    "schema":  {
                                                                                                   "type":  "integer"
                                                                                               }
                                                                                },
                                                                                {
                                                                                    "in":  "query",
                                                                                    "name":  "gammeId",
                                                                                    "schema":  {
                                                                                                   "type":  "string"
                                                                                               }
                                                                                },
                                                                                {
                                                                                    "in":  "query",
                                                                                    "name":  "search",
                                                                                    "schema":  {
                                                                                                   "type":  "string"
                                                                                               }
                                                                                }
                                                                            ],
                                                             "responses":  {
                                                                               "200":  {
                                                                                           "description":  "Paginated list of formules"
                                                                                       }
                                                                           }
                                                         },
                                                 "post":  {
                                                              "summary":  "Create a new formule",
                                                              "tags":  [
                                                                           "Products"
                                                                       ],
                                                              "requestBody":  {
                                                                                  "required":  true,
                                                                                  "content":  {
                                                                                                  "application/json":  {
                                                                                                                           "schema":  {
                                                                                                                                          "type":  "object"
                                                                                                                                      }
                                                                                                                       }
                                                                                              }
                                                                              },
                                                              "responses":  {
                                                                                "201":  {
                                                                                            "description":  "Formule created successfully"
                                                                                        }
                                                                            }
                                                          }
                                             },
                  "/api/products/formules/{id}":  {
                                                      "get":  {
                                                                  "summary":  "Get formule details with guarantees",
                                                                  "tags":  [
                                                                               "Products"
                                                                           ],
                                                                  "parameters":  [
                                                                                     {
                                                                                         "in":  "path",
                                                                                         "name":  "id",
                                                                                         "required":  true,
                                                                                         "schema":  {
                                                                                                        "type":  "string"
                                                                                                    }
                                                                                     }
                                                                                 ],
                                                                  "responses":  {
                                                                                    "200":  {
                                                                                                "description":  "Formule details with guarantees"
                                                                                            }
                                                                                }
                                                              },
                                                      "put":  {
                                                                  "summary":  "Update a formule",
                                                                  "tags":  [
                                                                               "Products"
                                                                           ],
                                                                  "parameters":  [
                                                                                     {
                                                                                         "in":  "path",
                                                                                         "name":  "id",
                                                                                         "required":  true,
                                                                                         "schema":  {
                                                                                                        "type":  "string"
                                                                                                    }
                                                                                     }
                                                                                 ],
                                                                  "responses":  {
                                                                                    "200":  {
                                                                                                "description":  "Formule updated successfully"
                                                                                            }
                                                                                }
                                                              },
                                                      "delete":  {
                                                                     "summary":  "Delete a formule",
                                                                     "tags":  [
                                                                                  "Products"
                                                                              ],
                                                                     "parameters":  [
                                                                                        {
                                                                                            "in":  "path",
                                                                                            "name":  "id",
                                                                                            "required":  true,
                                                                                            "schema":  {
                                                                                                           "type":  "string"
                                                                                                       }
                                                                                        }
                                                                                    ],
                                                                     "responses":  {
                                                                                       "200":  {
                                                                                                   "description":  "Formule deleted successfully"
                                                                                               }
                                                                                   }
                                                                 }
                                                  },
                  "/api/recordings/{fiche_id}":  {
                                                     "get":  {
                                                                 "tags":  [
                                                                              "Recordings"
                                                                          ],
                                                                 "summary":  "Get all recordings for a fiche",
                                                                 "description":  "Returns all audio recordings associated with a specific fiche",
                                                                 "parameters":  [
                                                                                    {
                                                                                        "in":  "path",
                                                                                        "name":  "fiche_id",
                                                                                        "required":  true,
                                                                                        "schema":  {
                                                                                                       "type":  "string"
                                                                                                   },
                                                                                        "description":  "The fiche ID to get recordings for"
                                                                                    }
                                                                                ],
                                                                 "responses":  {
                                                                                   "200":  {
                                                                                               "description":  "List of recordings with metadata"
                                                                                           },
                                                                                   "500":  {
                                                                                               "description":  "Server error"
                                                                                           }
                                                                               }
                                                             }
                                                 },
                  "/api/transcriptions/{fiche_id}":  {
                                                         "post":  {
                                                                      "tags":  [
                                                                                   "Transcriptions"
                                                                               ],
                                                                      "summary":  "Queue transcription for a fiche (async with Inngest)",
                                                                      "description":  "Queues a transcription job to Inngest for async processing",
                                                                      "parameters":  [
                                                                                         {
                                                                                             "in":  "path",
                                                                                             "name":  "fiche_id",
                                                                                             "required":  true,
                                                                                             "schema":  {
                                                                                                            "type":  "string"
                                                                                                        }
                                                                                         },
                                                                                         {
                                                                                             "in":  "query",
                                                                                             "name":  "priority",
                                                                                             "schema":  {
                                                                                                            "type":  "string",
                                                                                                            "enum":  [
                                                                                                                         "high",
                                                                                                                         "normal",
                                                                                                                         "low"
                                                                                                                     ]
                                                                                                        },
                                                                                             "description":  "Transcription priority level",
                                                                                             "default":  "normal"
                                                                                         }
                                                                                     ],
                                                                      "responses":  {
                                                                                        "200":  {
                                                                                                    "description":  "Transcription job queued successfully"
                                                                                                }
                                                                                    }
                                                                  }
                                                     },
                  "/api/transcriptions/{fiche_id}/status":  {
                                                                "get":  {
                                                                            "tags":  [
                                                                                         "Transcriptions"
                                                                                     ],
                                                                            "summary":  "Get transcription status for a fiche",
                                                                            "parameters":  [
                                                                                               {
                                                                                                   "in":  "path",
                                                                                                   "name":  "fiche_id",
                                                                                                   "required":  true,
                                                                                                   "schema":  {
                                                                                                                  "type":  "string"
                                                                                                              }
                                                                                               }
                                                                                           ],
                                                                            "responses":  {
                                                                                              "200":  {
                                                                                                          "description":  "Transcription status"
                                                                                                      }
                                                                                          }
                                                                        }
                                                            },
                  "/api/transcriptions/{fiche_id}/recordings/{call_id}":  {
                                                                              "get":  {
                                                                                          "tags":  [
                                                                                                       "Transcriptions"
                                                                                                   ],
                                                                                          "summary":  "Get transcription for a specific recording",
                                                                                          "parameters":  [
                                                                                                             {
                                                                                                                 "in":  "path",
                                                                                                                 "name":  "fiche_id",
                                                                                                                 "required":  true,
                                                                                                                 "schema":  {
                                                                                                                                "type":  "string"
                                                                                                                            }
                                                                                                             },
                                                                                                             {
                                                                                                                 "in":  "path",
                                                                                                                 "name":  "call_id",
                                                                                                                 "required":  true,
                                                                                                                 "schema":  {
                                                                                                                                "type":  "string"
                                                                                                                            }
                                                                                                             }
                                                                                                         ],
                                                                                          "responses":  {
                                                                                                            "200":  {
                                                                                                                        "description":  "Recording transcription data"
                                                                                                                    },
                                                                                                            "404":  {
                                                                                                                        "description":  "Recording or transcription not found"
                                                                                                                    }
                                                                                                        }
                                                                                      }
                                                                          },
                  "/api/transcriptions/batch":  {
                                                    "post":  {
                                                                 "tags":  [
                                                                              "Transcriptions"
                                                                          ],
                                                                 "summary":  "Batch transcribe multiple fiches (async with Inngest)",
                                                                 "description":  "Queues transcription jobs for multiple fiches to Inngest with batching",
                                                                 "requestBody":  {
                                                                                     "required":  true,
                                                                                     "content":  {
                                                                                                     "application/json":  {
                                                                                                                              "schema":  {
                                                                                                                                             "type":  "object",
                                                                                                                                             "required":  [
                                                                                                                                                              "fiche_ids"
                                                                                                                                                          ],
                                                                                                                                             "properties":  {
                                                                                                                                                                "fiche_ids":  {
                                                                                                                                                                                  "type":  "array",
                                                                                                                                                                                  "items":  {
                                                                                                                                                                                                "type":  "string"
                                                                                                                                                                                            },
                                                                                                                                                                                  "description":  "Array of fiche identifiers to transcribe",
                                                                                                                                                                                  "example":  [
                                                                                                                                                                                                  "1762209",
                                                                                                                                                                                                  "1753254"
                                                                                                                                                                                              ]
                                                                                                                                                                              },
                                                                                                                                                                "priority":  {
                                                                                                                                                                                 "type":  "string",
                                                                                                                                                                                 "enum":  [
                                                                                                                                                                                              "high",
                                                                                                                                                                                              "normal",
                                                                                                                                                                                              "low"
                                                                                                                                                                                          ],
                                                                                                                                                                                 "description":  "Transcription priority level",
                                                                                                                                                                                 "default":  "normal"
                                                                                                                                                                             }
                                                                                                                                                            }
                                                                                                                                         }
                                                                                                                          }
                                                                                                 }
                                                                                 },
                                                                 "responses":  {
                                                                                   "200":  {
                                                                                               "description":  "Batch transcription jobs queued successfully",
                                                                                               "content":  {
                                                                                                               "application/json":  {
                                                                                                                                        "schema":  {
                                                                                                                                                       "type":  "object",
                                                                                                                                                       "properties":  {
                                                                                                                                                                          "success":  {
                                                                                                                                                                                          "type":  "boolean"
                                                                                                                                                                                      },
                                                                                                                                                                          "message":  {
                                                                                                                                                                                          "type":  "string"
                                                                                                                                                                                      },
                                                                                                                                                                          "fiche_ids":  {
                                                                                                                                                                                            "type":  "array",
                                                                                                                                                                                            "items":  {
                                                                                                                                                                                                          "type":  "string"
                                                                                                                                                                                                      }
                                                                                                                                                                                        },
                                                                                                                                                                          "event_ids":  {
                                                                                                                                                                                            "type":  "array",
                                                                                                                                                                                            "items":  {
                                                                                                                                                                                                          "type":  "string"
                                                                                                                                                                                                      }
                                                                                                                                                                                        }
                                                                                                                                                                      }
                                                                                                                                                   }
                                                                                                                                    }
                                                                                                           }
                                                                                           },
                                                                                   "400":  {
                                                                                               "description":  "Invalid request - fiche_ids array required"
                                                                                           },
                                                                                   "500":  {
                                                                                               "description":  "Failed to queue transcriptions"
                                                                                           }
                                                                               }
                                                             }
                                                },
                  "/api/webhooks/test":  {
                                             "post":  {
                                                          "summary":  "Test webhook delivery",
                                                          "description":  "Send test webhook events to the frontend for testing purposes",
                                                          "tags":  [
                                                                       "Webhooks (Testing)"
                                                                   ],
                                                          "requestBody":  {
                                                                              "required":  true,
                                                                              "content":  {
                                                                                              "application/json":  {
                                                                                                                       "schema":  {
                                                                                                                                      "type":  "object",
                                                                                                                                      "properties":  {
                                                                                                                                                         "eventType":  {
                                                                                                                                                                           "type":  "string",
                                                                                                                                                                           "enum":  [
                                                                                                                                                                                        "audit.started",
                                                                                                                                                                                        "audit.progress",
                                                                                                                                                                                        "audit.completed",
                                                                                                                                                                                        "audit.failed",
                                                                                                                                                                                        "transcription.progress",
                                                                                                                                                                                        "transcription.completed",
                                                                                                                                                                                        "batch.progress",
                                                                                                                                                                                        "batch.completed",
                                                                                                                                                                                        "notification",
                                                                                                                                                                                        "all"
                                                                                                                                                                                    ],
                                                                                                                                                                           "description":  "Type of webhook event to send (or \u0027all\u0027 to send all types)"
                                                                                                                                                                       }
                                                                                                                                                     }
                                                                                                                                  },
                                                                                                                       "examples":  {
                                                                                                                                        "single":  {
                                                                                                                                                       "value":  {
                                                                                                                                                                     "eventType":  "notification"
                                                                                                                                                                 }
                                                                                                                                                   },
                                                                                                                                        "all":  {
                                                                                                                                                    "value":  {
                                                                                                                                                                  "eventType":  "all"
                                                                                                                                                              }
                                                                                                                                                }
                                                                                                                                    }
                                                                                                                   }
                                                                                          }
                                                                          },
                                                          "responses":  {
                                                                            "200":  {
                                                                                        "description":  "Webhook(s) sent successfully"
                                                                                    },
                                                                            "400":  {
                                                                                        "description":  "Invalid event type"
                                                                                    },
                                                                            "500":  {
                                                                                        "description":  "Webhook delivery failed"
                                                                                    }
                                                                        }
                                                      }
                                         },
                  "/api/webhooks/test/workflow":  {
                                                      "post":  {
                                                                   "summary":  "Simulate a complete audit workflow",
                                                                   "description":  "Sends a sequence of webhooks simulating a full audit lifecycle",
                                                                   "tags":  [
                                                                                "Webhooks (Testing)"
                                                                            ],
                                                                   "requestBody":  {
                                                                                       "required":  false,
                                                                                       "content":  {
                                                                                                       "application/json":  {
                                                                                                                                "schema":  {
                                                                                                                                               "type":  "object",
                                                                                                                                               "properties":  {
                                                                                                                                                                  "delay":  {
                                                                                                                                                                                "type":  "number",
                                                                                                                                                                                "description":  "Delay in milliseconds between events (default 1000)",
                                                                                                                                                                                "example":  2000
                                                                                                                                                                            }
                                                                                                                                                              }
                                                                                                                                           }
                                                                                                                            }
                                                                                                   }
                                                                                   },
                                                                   "responses":  {
                                                                                     "200":  {
                                                                                                 "description":  "Workflow simulation completed"
                                                                                             }
                                                                                 }
                                                               }
                                                  },
                  "/api/webhooks/test/custom":  {
                                                    "post":  {
                                                                 "summary":  "Send custom webhook event",
                                                                 "description":  "Send a custom webhook with any event type and data",
                                                                 "tags":  [
                                                                              "Webhooks (Testing)"
                                                                          ],
                                                                 "requestBody":  {
                                                                                     "required":  true,
                                                                                     "content":  {
                                                                                                     "application/json":  {
                                                                                                                              "schema":  {
                                                                                                                                             "type":  "object",
                                                                                                                                             "properties":  {
                                                                                                                                                                "event":  {
                                                                                                                                                                              "type":  "string",
                                                                                                                                                                              "description":  "Event type",
                                                                                                                                                                              "example":  "audit.progress"
                                                                                                                                                                          },
                                                                                                                                                                "data":  {
                                                                                                                                                                             "type":  "object",
                                                                                                                                                                             "description":  "Event data"
                                                                                                                                                                         },
                                                                                                                                                                "source":  {
                                                                                                                                                                               "type":  "string",
                                                                                                                                                                               "description":  "Source service name",
                                                                                                                                                                               "example":  "test-service"
                                                                                                                                                                           }
                                                                                                                                                            }
                                                                                                                                         }
                                                                                                                          }
                                                                                                 }
                                                                                 },
                                                                 "responses":  {
                                                                                   "200":  {
                                                                                               "description":  "Custom webhook sent"
                                                                                           }
                                                                               }
                                                             }
                                                }
              },
    "components":  {

                   }
}
